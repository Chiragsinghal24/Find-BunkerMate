<html>

<head>
    <meta charset="UTF-8">
    <title>Sorting JSON Data</title>
    <link rel="stylesheet" href="style12.css">
</head>

<body>
    <main class="table">
        <section class="table__header">
            <ul>
                <li>
                    <div class="dropdown">
                        <select id="year" name="year">
                            <option value="all">All Years</option>
                            <option value="1">1st Year</option>
                            <option value="2">2nd Year</option>
                            <option value="3">3rd Year</option>
                            <option value="4">4th Year</option>
                        </select>
                    </div>
                </li>
                <li>
                    <div class="dropdown">
                        <select id="branch" name="branch">
                            <option value="all">All Branches</option>
                            <option value="CSE">Computer Science</option>
                            <option value="ECE">Electronics</option>
                            <option value="ME">Mechanical</option>
                            <option value="CE">Civil</option>
                        </select>
                    </div>
                </li>
            </ul>
        </section>
        <section class="table__body">
            <table id="studentTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>CGPA</th>
                        <th>Branch</th>
                        <th>Year</th>
                        <th>Add</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <script>
                const studentData = [
                    { "name": "Prashant", "phone": "918744969975", "cgpa": 8.5, "branch": "IT", "year": 2 },
                    { "name": "Alice", "phone": "2345678901", "cgpa": 9.0, "branch": "ECE", "year": 3 },
                    { "name": "Bob", "phone": "3456789012", "cgpa": 7.5, "branch": "ME", "year": 4 },
                    { "name": "Charlie", "phone": "4567890123", "cgpa": 8.0, "branch": "CE", "year": 2 },
                    { "name": "David", "phone": "5678901234", "cgpa": 9.5, "branch": "CSE", "year": 4 },
                    { "name": "Eva", "phone": "6789012345", "cgpa": 7.0, "branch": "ECE", "year": 1 },
                    { "name": "Frank", "phone": "7890123456", "cgpa": 8.0, "branch": "ME", "year": 3 },
                    { "name": "Grace", "phone": "8901234567", "cgpa": 9.2, "branch": "CE", "year": 4 }
                ];

                const studentTable = document.getElementById("studentTable");
                const studentTableBody = studentTable.getElementsByTagName("tbody")[0];

                function populateTable(data) {
                    studentTableBody.innerHTML = "";
                    for (let i = 0; i < data.length; i++) {
                        const student = data[i];
                        const row = studentTableBody.insertRow();
                        row.insertCell().innerHTML = student.name;
                        row.insertCell().innerHTML = student.phone;
                        row.insertCell().innerHTML = student.cgpa;
                        row.insertCell().innerHTML = student.branch;
                        row.insertCell().innerHTML = student.year;
                        //https://wa.me/919988776655?text=Hi+name%2C+I+got+your+contact+from+bunkermate.github.io.+Will+you+add+me+as+your+roommate%3F+Check+my+details+here%3A+bunkermate.github.io%2F+student.phone
                        let link = "https://wa.me/" + student.phone + "?text=Hi+name%2C+I+got+your+contact+from+bunkermate.github.io.+Will+you+add+me+as+your+roommate%3F+Check+my+details+here%3A+bunkermate.github.io%2F" + student.phone;
                        let linkHtml = '<a class="add_btn" href="' + link + '"><b>+ Add <b><img src=\'wsap.png\'></a>';
                        row.insertCell().innerHTML = linkHtml;
                    }
                }
                function filterData() {
                    let yearValue = document.getElementById("year").value;
                    let branchValue = document.getElementById("branch").value;
                    let filteredData = studentData.filter(student => {
                        if (yearValue === "all" && branchValue === "all") {
                            return true;
                        }
                        if (yearValue === "all" && branchValue !== "all") {
                            return student.branch === branchValue;
                        }
                        if (yearValue !== "all" && branchValue === "all") {
                            return student.year === parseInt(yearValue);
                        }
                        return student.year === parseInt(yearValue) && student.branch === branchValue;
                    });
                    filteredData.sort((a, b) => {
                        if (a.year < b.year) {
                            return -1;
                        }
                        if (a.year > b.year) {
                            return 1;
                        }
                        if (a.cgpa > b.cgpa) {
                            return -1;
                        }
                        if (a.cgpa < b.cgpa) {
                            return 1;
                        }
                        return 0;
                    });
                    populateTable(filteredData);
                }

                document.getElementById("year").addEventListener("change", filterData);
                document.getElementById("branch").addEventListener("change", filterData);

                populateTable(studentData);
            </script>
</body>

</html>