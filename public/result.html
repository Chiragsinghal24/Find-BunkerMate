<html>

<head>
    <meta charset="UTF-8">
    <title>Find BunkerMate</title>
    <link rel="stylesheet" href="style12.css">
</head>

<body>
    <main class="table">
        <section class="table__header">
            <ul>
                <li>
                    <div class="dropdown">
                        <select id="year" name="year">
                            <option value="all">All Years</option>
                            <option value="1">1st Year</option>
                            <option value="2">2nd Year</option>
                            <option value="3">3rd Year</option>
                            <option value="4">4th Year</option>
                        </select>
                    </div>
                </li>
                <li>
                    <div class="dropdown">
                        <select id="branch" name="branch">
                            <option value="all">All Branches</option>
                            <option value="CSE">Computer Science</option>
                            <option value="ECE">Electronics</option>
                            <option value="ME">Mechanical</option>
                            <option value="CE">Civil</option>
                        </select>
                    </div>
                </li>
            </ul>
        </section>
        <section class="table__body">
            <table id="studentTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>CGPA</th>
                        <th>Branch</th>
                        <th>Year</th>
                        <th>Add</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <script>

                const studentTable = document.getElementById("studentTable");
                const studentTableBody = studentTable.getElementsByTagName("tbody")[0];

                async function populateTable() {
                    const response = await fetch("https://mateflix.onrender.com/api/getData");
                    const data = await response.json();
                    studentTableBody.innerHTML = "";
                    for (let i = 0; i < data.length; i++) {
                        const student = data[i];
                        const row = studentTableBody.insertRow();
                        row.insertCell().innerHTML = student.name;
                        row.insertCell().innerHTML = student.phone;
                        row.insertCell().innerHTML = student.cgpa;
                        row.insertCell().innerHTML = student.branch;
                        row.insertCell().innerHTML = student.year;
                        let link = "https://wa.me/" + student.phone + `?text=Hi+${student.name}%2C+I+got+your+contact+from+mateflix.onrender.com+I+was+planning+if+you'd+be+interested+in+being+my+roommate+this+semester%3F+Let+me+know+what+you+think%21`;
                        let linkHtml = '<a class="add_btn" href="' + link + ' " target="_blank"><b>+ Add <b><img src=\'wsap.png\'></a>';
                        row.insertCell().innerHTML = linkHtml;
                    }
                }
                function filterData() {
                    let yearValue = document.getElementById("year").value;
                    let branchValue = document.getElementById("branch").value;
                    let filteredData = studentData.filter(student => {
                        if (yearValue === "all" && branchValue === "all") {
                            return true;
                        }
                        if (yearValue === "all" && branchValue !== "all") {
                            return student.branch === branchValue;
                        }
                        if (yearValue !== "all" && branchValue === "all") {
                            return student.year === parseInt(yearValue);
                        }
                        return student.year === parseInt(yearValue) && student.branch === branchValue;
                    });
                    filteredData.sort((a, b) => {
                        if (a.year < b.year) {
                            return -1;
                        }
                        if (a.year > b.year) {
                            return 1;
                        }
                        if (a.cgpa > b.cgpa) {
                            return -1;
                        }
                        if (a.cgpa < b.cgpa) {
                            return 1;
                        }
                        return 0;
                    });
                    populateTable(filteredData);
                }

                document.getElementById("year").addEventListener("change", filterData);
                document.getElementById("branch").addEventListener("change", filterData);

                populateTable();
            </script>
</body>

</html>
